<div class="container">
  <div class="title-block">
    <div class="row" >
      <div class="col-2">
        <%= image_tag(@university.logo, width: "100%") %>
      </div>

      <div class="col-6">
        <div>
          <i class="fa-solid fa-location-dot"></i>
          <span style="color:grey"><%= @university.city %> | <%= @university.country %></span>
        </div>
        <div class="row">
          <div class="col-10">
            <span id="university-name" style="font-size:36px"><strong><%= @university.name %></strong></span><br>
          </div>
          <div class="col-2" style="margin: auto">
            <i id="heart-button" data-controller="add-to-favourite-animation" data-action="click->add-to-favourite-animation#heartAnimation">
              <span class="fa-solid fa-heart active"></span>
            </i>
          </div>
        </div>
        <div class="row">
          <div class="col-6">
            Overall Rating based on <%= @university.reviews.length %> Reviews<br>
            <i class="fa-solid fa-trophy"></i> Ranked Globally: #<%= @university.ranking %><br>
              <i class="fa-solid fa-crown"></i> Uni-Versus Ranking: <strong>#<%= @internal_ranking %></strong><br>
          </div>
          <div class="col-2">
            <div class="circle-rating">
              <%= @university.global_avg.round(3) * 20 %>
            </div>
          </div>
          <div class="col-4">
          </div>
        </div>
        <div class="my-3">
          <button class="accordian-button btn search-btn" type="button" data-bs-toggle="collapse" data-bs-target="#collapse" aria-expanded="true" aria-controls="collapse">
              Description
          </button>
          <a class="btn search-btn" href="#reviews-section">Leave a review</a>
          <a class="btn search-btn" href=<%= @university.url %> >Official Website</a>
        </div>
      </div>

      <div id="university-img" class="carousel slide col-4" data-bs-ride="true" data-interval="5000">
        <div class="carousel-indicators">
          <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
          <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="1" aria-label="Slide 2"></button>
          <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="2" aria-label="Slide 3"></button>
        </div>
        <div class="carousel-inner">
          <div class="carousel-item active">
            <%= image_tag(@university.image, width: "100%") %>
          </div>
          <div class="carousel-item">
            <%= image_tag(@university.image2, width: "100%") %>
          </div>
          <div class="carousel-item">
            <%= image_tag(@university.image3, width: "100%") %>
          </div>
        </div>
        <button class="carousel-control-prev" type="button" data-bs-target="#university-img" data-bs-slide="prev">
          <span class="carousel-control-prev-icon" aria-hidden="true"></span>
          <span class="visually-hidden">Previous</span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#university-img" data-bs-slide="next">
          <span class="carousel-control-next-icon" aria-hidden="true"></span>
          <span class="visually-hidden">Next</span>
        </button>
      </div>
    </div>
    <div class="accordion" id="accordion">
      <div class="accordion-item">
        <div id="collapse" class="accordion-collapse collapse" aria-labelledby="heading" data-bs-parent="#accordion">
          <div class="accordion-body">
            <p><%= @university.description %></p><br>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="main-body-container">
    <div class="side-nav-menu">
      <div>
        <nav>
          <a href="#info-section">Info</a>
          <a href="#departments-section">Faculties</a>
          <a href="#map-section">Check it out</a>
          <a href="#reviews-section">Reviews</a>
        </nav>
      </div>
    </div>

    <div class="body-content row">
      <div class="nav-bar-spacer col-2">
      </div>
      <div class="col-10">
        <section>
          <div class="row">
            <div class="col-3">
              Student Population:<br>
                <i class="fa fa-user"></i>  <%= @university.student_count %><br><br>
              Average fees for locals:<br>
                <i data-price="3.2"></i> <%= @university.domestic_course_fee %><br><br></i>
              Average fees for foreigners:<br>
                <i data-price="1.7"></i> <%= @university.international_course_fee %><br><br>
            </div>
            <div id="info-section"
              data-controller="display-circle-ratings"
              class="stats-grid col-9">
              <div class="row">
                <div class="col-3 stats-elements">Reputation</div>
                <div class="col-3 stats-elements">Education Quality</div>
                <div class="col-3 stats-elements">Facilities/<br>Accomodation</div>
                <div class="col-3 stats-elements">Course Difficulty<br></div>
              </div>
              <div class="row">
                <div class="col-3">
                  <div class="circle-rating stats-elements"><%= @university.reputability_avg * 20 %></div>
                </div>
                <div class="col-3">
                  <div class="circle-rating stats-elements"><%= @university.education_quality_avg * 20 %></div>
                </div>
                <div class="col-3">
                  <div class="circle-rating stats-elements"><%= @university.campus_facilities_accom_avg * 20 %></div>
                </div>
                <div class="col-3">
                  <div class="circle-rating stats-elements"><%= @university.course_difficulty_avg * 20 %></div>
                </div>
              </div>
              <div class="row">
                <div class="col-3 stats-elements">Social elements</div>
                <div class="col-3 stats-elements">Value for Money</div>
                <div class="col-3 stats-elements">Safety</div>
                <div class="col-3 stats-elements">Career Services</div>
              </div>
              <div class="row">
                <div class="col-3">
                  <div class="circle-rating stats-elements "><%= @university.social_element_avg * 20 %></div>
                </div>
                <div class="col-3">
                  <div class="circle-rating stats-elements"><%= @university.value_for_money_avg * 20 %></div>
                </div>
                <div class="col-3">
                  <div class="circle-rating stats-elements"><%= @university.safety_avg * 20 %></div>
                </div>
                <div class="col-3">
                  <div class="circle-rating stats-elements"><%= @university.career_services_avg * 20 %></div>
                </div>
              </div>
            </div>
          </div>
        </section>

        <hr>

        <section id="departments-section" class="row">
        Check out the Faculties of <%= @university.name %> below!<br>

          <div class="container text-center my-3">
            <div class="row">
              <div id="card-carousel" class="carousel slide" data-controller="cards-carousel" data-ride="carousel" data-interval="12000">
                <div class="carousel-inner" role="listbox">
                  <% @departments.each.with_index do |department, i| %>
                    <% if i == 0 %>
                      <div class="carousel-item active card col-lg-4 d-none d-lg-block">
                        <div>
                          <br><strong><%= department.name %></strong><br><br>
                        </div>
                        <div>
                          <% department.courses do |course| %>
                            <%= department.course%><br>
                          <% end %>
                        </div>
                      </div>
                    <% else %>
                      <div class="carousel-item card col-lg-4">
                        <div>
                          <br><strong><%= department.name %></strong><br><br>
                        </div>
                        <div>
                          <% @sorted_educations = Education.where(department_id: department.id) %>
                          <% @sorted_educations.each do |education| %>
                            <%= education.course %><br>
                          <% end %>
                        </div>
                      </div>
                    <% end %>
                  <% end %>
                </div>
                <a class="carousel-control-prev w-auto" href="#card-carousel" role="button" data-slide="prev">
                  <span class="carousel-control-prev-icon bg-dark border border-dark rounded-circle" aria-hidden="true"></span>
                  <span class="sr-only">Previous</span>
                </a>
                <a class="carousel-control-next w-auto" href="#card-carousel" role="button" data-slide="next">
                  <span class="carousel-control-next-icon bg-dark border border-dark rounded-circle" aria-hidden="true"></span>
                  <span class="sr-only">Next</span>
                </a>
              </div>
            </div>
          </div>
        </section>

        <hr>

        <section id="map-section" class="row">
          <div id="map" class="col-9">
            <div class="" style="width: 100%; height: 450px;"
              data-controller="map"
              data-map-markers-value="<%= @markers.to_json %>"
              data-map-api-key-value="<%= ENV['MAPBOX_API_KEY'] %>">
            </div>
          </div>

          <div class="col-3">
            <strong><%= @university.name %></strong><br><br>
            <span id="university.address"><% @university.address.split(", ").each do |line|%>
              <%= "#{line}"%><br>
            <% end %>
            </span>
            <br>Enrollment Deadline:<br>
            <span id="create-invite"><%= @university.application_deadline %></span>
            <button type="button"
            data-controller="calendar"
            name-value="<%= @university.name.to_json %>"
            deadline-value="<%= @university.application_deadline.to_json %>"
            address-value="<%= @university.address.to_json %>"
            data-action="click->calendar#createInvite"
            class="btn btn-secondary">Book a campus tour</button>
          </div>
        </section>

        <hr>

        <section id="reviews-section" class="row">
          <div data-controller="insert-in-list" data-insert-in-list-position-value="afterbegin">

            <div class="d-flex justify-content-between">
              <h5><strong>Reviews</strong></h5>
              <div>
                <% if @can_review %>
                  <a href="" data-bs-toggle="modal" data-bs-target="#exampleModal" class="review-link"><strong>Leave a review</strong></a>
                  <%= render "review_form" %>
                <% else %>
                  <span id="btn-tooltip" class="d-inline-block" tabindex="0" data-bs-toggle="tooltip" title="Add your education record in your profile to leave a review!">
                    <a href="" class="review-link disabled-link"><strong>Leave a review</strong></a>
                  </span>
                <% end %>
                <%# <span id="btn-tooltip" class="d-inline-block" tabindex="0" data-bs-toggle="tooltip" title="Hello tooltip">
                  <button class="btn btn-primary" type="button" disabled>Disabled button</button>
                </span> %>
              </div>
            </div>

            <% if user_signed_in? %>
              <%= paginate @reviews, remote: true %>
            <% end %>

            <div data-insert-in-list-target="items">
              <% @reviews.each do |review| %>
                <% education = review.user.educations.where(university: @university) %>
                <% average_review_rating = (review.reputabilty_rating + review.education_quality_rating + review.campus_facilities_accom_rating + review.course_difficulty_rating + review.social_element_rating + review.value_for_money_rating + review.safety_rating + review.career_services_rating) / 8.0 %>
                <%= render "universities/review", review: review, education: education, average_review_rating: average_review_rating %>
              <% end %>

              <% if current_user == nil %>
                <button type="button" class="save-btn width-100" data-bs-toggle="modal" data-bs-target="#staticBackdrop">
                  View more reviews
                </button>
              <% end %>
            </div>
          </div>
        </section>
      </div>
    </div>
  </div>
</div>
